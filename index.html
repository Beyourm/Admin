<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>صفحة بأربعة تبويبات مُفصَّلة ديناميكياً</title>

<link rel="stylesheet" href="styles.css">

<link rel="stylesheet" href="../../assets/fonts/tajawal.css">

</head>
<body>

<div id="loader">جاري التحميل...</div>

<div class="header">
  <div id="search-placeholder"></div> 
  <div id="select-placeholder"></div> 
</div>

<div class="content">
  <div class="tab-content" id="tab-content-1" role="tabpanel" aria-labelledby="tab-link-1"></div>
  <div class="tab-content" id="tab-content-2" role="tabpanel" aria-labelledby="tab-link-2"></div>
  <div class="tab-content" id="tab-content-3" role="tabpanel" aria-labelledby="tab-link-3"></div>
  <div class="tab-content" id="tab-content-4" role="tabpanel" aria-labelledby="tab-link-4"></div>
</div>

<div class="tabs" role="tablist">
  <div class="tab" id="tab-link-1" role="tab" aria-controls="tab-content-1" onclick="showTab(1, 'tab1-students.html')">ج الطلاب</div>
  <div class="tab" id="tab-link-2" role="tab" aria-controls="tab-content-2" onclick="showTab(2, 'tab2-payers.html')">ج الدافعين</div>
  <div class="tab" id="tab-link-3" role="tab" aria-controls="tab-content-3" onclick="showTab(3, 'tab3-marketers.html')">ج المسوقين</div>
  <div class="tab" id="tab-link-4" role="tab" aria-controls="tab-content-4" onclick="showTab(4, 'tab4-commissions.html')">العمولات</div>
</div>

<script>
// تحديد التبويب النشط حالياً لتجنب إعادة التحميل غير الضرورية
let currentActiveTab = 1;
const tabContents = document.querySelectorAll('.tab-content');

// ---------------- وظيفة جلب المحتوى الديناميكي ----------------
async function fetchAndLoad(file, targetElement) {
    try {
        const response = await fetch(file);
        if (!response.ok) {
            throw new Error(`Failed to load ${file}: ${response.statusText}`);
        }
        const html = await response.text();
        targetElement.innerHTML = html;
        return true;
    } catch (error) {
        console.error('Error loading content:', error);
        // هنا نستخدم التنسيقات مباشرة لأننا فصلنا CSS الخارجي
        targetElement.innerHTML = `<div style="color: #E74C3C; background: #FFECEC; padding: 15px; border-radius: 5px;">خطأ في تحميل ${file}: يرجى التأكد من وجود الملف في المسار الصحيح.</div>`;
        return false;
    }
}

// ---------------- وظيفة عرض التبويبات ----------------
async function showTab(tabIndex, tabFile) {
  if (currentActiveTab === tabIndex && tabContents[tabIndex - 1].innerHTML.trim() !== "") {
    // إذا كان التبويب نشطاً بالفعل ومحملاً، لا تفعل شيئاً
    return;
  }
  
  const tabs = document.querySelectorAll('.tab');
  const targetContent = document.getElementById(`tab-content-${tabIndex}`);

  // 1. إزالة فئة 'active' من جميع التبويبات والمحتويات
  tabs.forEach((tab, i) => {
    tab.classList.remove('active');
    tab.setAttribute('aria-selected', 'false');
    tabContents[i].classList.remove('active');
  });

  // 2. تفعيل التبويب الجديد
  tabs[tabIndex - 1].classList.add('active');
  tabs[tabIndex - 1].setAttribute('aria-selected', 'true');
  currentActiveTab = tabIndex;

  // 3. جلب وتحميل المحتوى (فقط إذا كان فارغاً)
  if (targetContent.innerHTML.trim() === "") {
     await fetchAndLoad(tabFile, targetContent);
  }

  // 4. تفعيل عرض المحتوى
  targetContent.classList.add('active');
}

// ---------------- Initialization (تشغيل) ----------------
document.addEventListener('DOMContentLoaded', async () => {
    
    // 1. تحميل مكونات Header 
    fetchAndLoad('header-search.html', document.getElementById('search-placeholder'));
    fetchAndLoad('header-select.html', document.getElementById('select-placeholder'));

    // 2. تحميل محتوى التبويب الأول وضمان عرضه
    await fetchAndLoad('tab1-students.html', document.getElementById('tab-content-1'));
    
    // 3. إخفاء الـ Loader عند انتهاء تحميل الهيكل الأساسي والمحتوى الأولي
    const loader = document.getElementById('loader');
    loader.style.opacity = '0';
    setTimeout(() => {
        loader.style.display = 'none';
    }, 500);

    // 4. تفعيل التبويب الأول بشكل صريح
    showTab(1, 'tab1-students.html');
});
</script>

</body>
</html>
